'use strict';

/**
 * Offline QR version:
 * - Each ticket includes qrPngDataUrl (data:image/png;base64,...) so it works without network.
 * - If you change qrData, you must regenerate qrPngDataUrl (see comment below).
 */

/** QR border color options (used by the initial picker). */
const BORDER_COLORS = {
  Green:   '#2bb673',
  Magenta: '#9c27b0',
  Pink:    '#ff4fa8',
  Red:     '#e53935',
  Silver:  '#bfc5cc',
  Yellow:  '#f2d100',
  Blue:    '#2a79ff'
};

/**
 * Tickets:
 * - qrData is your logical payload (for you to manage)
 * - qrPngDataUrl is the offline QR image (what the page actually displays)
 *
 * To regenerate offline QR data URLs (Python example):
 *   import qrcode, base64, io
 *   from PIL import Image
 *   def make_url(text):
 *       qr=qrcode.QRCode(error_correction=qrcode.constants.ERROR_CORRECT_M, box_size=24, border=0)
 *       qr.add_data(text); qr.make(fit=True)
 *       img=qr.make_image(fill_color="black", back_color="white").convert("RGB")
 *       b=io.BytesIO(); img.save(b, format="PNG", optimize=True)
 *       return "data:image/png;base64,"+base64.b64encode(b.getvalue()).decode()
 */
const tickets = [
  {
    routeType: 'INTERSTATE',
    zoneNumber: '2',
    zoneLabel: 'ZONE RIDE',
    zoneSub: '1 Adult',
    qrData: 'TICKET|INTERSTATE|2|1ADULT|A',
    qrPngDataUrl: 'data:image/png;base64,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'
  },
  {
    routeType: 'INTRASTATE',
    zoneNumber: '1',
    zoneLabel: 'ZONE RIDE',
    zoneSub: '1 Adult',
    qrData: 'TICKET|INTRASTATE|1|1ADULT|B',
    qrPngDataUrl: 'data:image/png;base64,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'
  },
  {
    routeType: 'INTRASTATE',
    zoneNumber: '1',
    zoneLabel: 'ZONE RIDE',
    zoneSub: '1 Adult',
    qrData: 'TICKET|INTRASTATE|1|1ADULT|C',
    qrPngDataUrl: 'data:image/png;base64,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'
  }
];

let timerIntervalId = null;
let qrModalInitialized = false;
let resizeListenerInitialized = false;

/* ---------- Boot ---------- */
document.addEventListener('DOMContentLoaded', () => {
  wireColorPicker();

  // If the user previously picked a border color, pre-apply it,
  // but still show the picker (closer to the original app flow).
  const saved = localStorage.getItem('qrBorderColorKey');
  if (saved && BORDER_COLORS[saved]) {
    applyBorderColor(saved);
  }
});

/* ---------- Color picker ---------- */
function wireColorPicker() {
  const overlay = document.getElementById('color-selection');
  if (!overlay) return;

  overlay.querySelectorAll('button[data-color]').forEach(btn => {
    btn.addEventListener('click', () => {
      const key = btn.getAttribute('data-color');
      if (!BORDER_COLORS[key]) return;

      applyBorderColor(key);
      localStorage.setItem('qrBorderColorKey', key);
      hidePicker();
      initializePage();
    });
  });
}

function hidePicker() {
  const overlay = document.getElementById('color-selection');
  if (overlay) overlay.style.display = 'none';
}

function applyBorderColor(key) {
  const hex = BORDER_COLORS[key] || BORDER_COLORS.Yellow;
  document.documentElement.style.setProperty('--qr-border', hex);
}

/* ---------- Main page ---------- */
function initializePage() {
  startTimer(30 * 60);

  // Choose ticket by URL param first, else random.
  const idx = getTicketIndexFromUrl();
  setTicket(Number.isFinite(idx) ? idx : Math.floor(Math.random() * tickets.length));

  setupQrModal();

  // On rotation / resize, re-apply the current ticket (mainly for layout consistency).
  if (!resizeListenerInitialized) {
    resizeListenerInitialized = true;
    window.addEventListener('resize', () => {
      const currentIdx = getCurrentTicketIndex();
      if (currentIdx !== null) setTicket(currentIdx);
    });
  }
}

/* ---------- Timer ---------- */
function startTimer(durationInSeconds) {
  let timer = durationInSeconds;
  const timerElement = document.getElementById('timer');
  if (!timerElement) return;

  function updateTimerDisplay() {
    const hours = Math.floor(timer / 3600);
    const minutes = Math.floor((timer % 3600) / 60);
    const seconds = timer % 60;

    const mmss = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    const hmmss = `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    timerElement.textContent = `Expires in ${hours > 0 ? hmmss : mmss}`;
  }

  updateTimerDisplay();

  if (timerIntervalId) clearInterval(timerIntervalId);
  timerIntervalId = setInterval(() => {
    if (timer > 0) {
      timer--;
      updateTimerDisplay();
    }
  }, 1000);
}

/* ---------- Ticket selection ---------- */
function getTicketIndexFromUrl() {
  try {
    const url = new URL(window.location.href);
    const t = url.searchParams.get('t');
    if (t === null) return null;

    const raw = parseInt(t, 10);
    if (!Number.isFinite(raw)) return null;

    // Support both: ?t=1..N (more natural) and ?t=0..N-1 (legacy)
    const idx = raw >= 1 ? raw - 1 : raw;
    if (idx < 0 || idx >= tickets.length) return null;
    return idx;
  } catch {
    return null;
  }
}

function getCurrentTicketIndex() {
  const rt = document.getElementById('route-type')?.textContent ?? '';
  const zn = document.getElementById('zone-number')?.textContent ?? '';
  const zs = document.getElementById('zone-sub')?.textContent ?? '';
  const i = tickets.findIndex(t => t.routeType === rt && t.zoneNumber === zn && t.zoneSub === zs);
  return i >= 0 ? i : null;
}

function setTicket(index) {
  const t = tickets[index] || tickets[0];

  document.getElementById('route-type').textContent = t.routeType;
  document.getElementById('zone-number').textContent = t.zoneNumber;
  document.getElementById('zone-label').textContent = t.zoneLabel;
  document.getElementById('zone-sub').textContent = t.zoneSub;

  const qrImg = document.getElementById('qr-image');
  qrImg.src = t.qrPngDataUrl; // offline
  qrImg.dataset.qrData = t.qrData;
}

/* ---------- QR modal ---------- */
function setupQrModal() {
  if (qrModalInitialized) return;
  qrModalInitialized = true;

  const frame = document.getElementById('qr-frame');
  const qrImg = document.getElementById('qr-image');
  const modal = document.getElementById('qr-modal');
  const modalImg = document.getElementById('qr-modal-img');

  function openModal() {
    if (!qrImg || !qrImg.src) return;
    modalImg.src = qrImg.src;
    modal.classList.add('show');
    modal.setAttribute('aria-hidden', 'false');
  }

  function closeModal() {
    modal.classList.remove('show');
    modal.setAttribute('aria-hidden', 'true');
  }

  frame.addEventListener('click', openModal);
  frame.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      openModal();
    }
  });

  modal.addEventListener('click', closeModal);
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeModal();
  });
}
